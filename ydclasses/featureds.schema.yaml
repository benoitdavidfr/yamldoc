$schema: http://json-schema.org/draft-07/schema#
title: Schema d'un FeatureDataset, version 7/1/2019
definitions:
  layerDictionary:
    description: dictionnaire des couches indexé par leur nom
    type: object
    patternProperties: # la propriété est le nom de la couche
      '^[-a-zA-Z0-9_]+$':
        description: description de chaque couche
        type: object
        required: [title]
        properties:
          title:
            type: string
          abstract:
            type: string
          description:
            type: string
          conformsTo:
            description: éléments de spécification
            type: object
            properties:
              source:
                type: string
              description:
                type: string
              issues:
                type: string
              note:
                type: string
              geometryType:
                description: le type géométrique des objets de la couche
                type: string
                enum: [Point, LineString]
              properties:
                description: dictionnaire de certains champs des objets identifiés par le nom du champ
                type: object
                patternProperties: # la propriété est le nom du champ
                  '^[a-zA-Z0-9]+$':
                    description: description de certains champs des objets de la couche
                    type: object
                    properties:
                      abstract:
                        description: résumé du champ
                        type: string
                      description:
                        description: commentaire sur le champ
                        type: string
                      enum:
                        description: liste des valeurs autorisées pour le champ sous la forme d'un dictionnaire
                        type: object
                        patternProperties: # la propriété est la valeur autorisée
                          "^[-a-zA-Z0-9_ àéèîôù']*$":
                            description: description de la valeur autorisée
                            type: object
                            properties:
                              description:
                                description: commentaire sur la valeur
                                type: string 
          editorialNote:
            type: string
          minZoom:
            description: zoom minimum d'affichage des couches
            type: integer
          onZoomGeo:
            description: dictionnaire des filtres en fonction du zoom
            type: object
            patternProperties: # la propriété est le numéro du zoom
              '^[0-9]+$':
                description: description de chaque couche
                oneOf:
                  - description: filtre
                    type: string
                  - description: filtre défini par zone
                    type: object
          style:
            description: style des objets de la couche soit comme objet soit comme fonction JavaScript retournant un objet
            oneOf:
              - description: style sous la forme d'un code JavaScript définition une fonction retournant un objet style
                type: string
              - description: style Leaflet défini comme dictionnaire (ne pas prendre celui dans definitions car bug)
                type: object
                properties: { color: { type: string }, weight: { type: integer }, opacity: { type: number } }
          styleMap:
            description: dictionnaire des styles par champ de la table et valeur pour ce champ ou style par défaut
            type: object
            patternProperties: # la propriété est le nom du champ de la table
              '^default$':
                description: style par défaut
                $ref: '#/definitions/leafletStyle'
              '^[a-zA-Z0-9_]+$':
                description: dictionnaire des styles par valeur pour le champ
                type: object
                patternProperties: # la propriété est la valeur prise pour un champ de la table
                  "^[-a-zA-Z0-9_ âéèêîôù']*$":
                    description: objet style Leaflet
                    $ref: '#/definitions/leafletStyle'
          pointToLayer:
            description: pour les couches ponctuelles, fonction JavaScript indiquant le symbole à afficher
            type: string
          displayedByDefault:
            description: si cette propriété est présente alors la couche est affichées par défaut dans la carte
            type: boolean
            const: true
          ogrPath:
            description: le (ou les) chemin(s) du (ou des) fichier(s) OGR à charger dans MySQL pour cette couche
            oneOf:
              - description: en général un seul chemin
                type: string
              - description: possibilité de plusieurs fichiers à charger
                type: array
                items:
                  type: string
          excludedFields:
            description: liste des champs à exclure du chargement dans MySQL
            type: array
            items:
              type: string
          fieldtypes:
            description: dictionnaire des types MySQL devant être corrigés identifiés par nom de champ dans la table SQL
            type: object
            patternProperties: # la propriété est le nom du champ de la table
              '^[a-zA-Z0-9_]+$':
                description: type SQL en remplacement de celui fourni
                type: string
          indexes:
            description: dict. des index à créer au chargement de la couche dans MySQL en fonction des noms de champ
            type: object
            patternProperties: # la propriété est le nom du champ de la table
              '^[a-zA-Z0-9_]+$':
                description: true pour index à créer
                type: boolean
                const: true
          typename:
            description: nom du type WFS pour les couches définies par WFS
            type: string
          select:
            description: critère de sélection
            type: string
    
  leafletStyle:
    description: style utilisé par Leaflet pour représenté graphiquement des objets GeoJSON d'une couche
    type: object
    properties:
      color:
        type: string
      weight:
        type: integer
      opacity:
        type: number
    example: { color: blue, weight: 2, opacity: 0.65 }
    
description: description d'un FeatureDataset
type: object
required: [title, yamlClass]
properties:
  title:
    type: string
  abstract:
    type: string
  source:
    type: string
  creator:
    type: string
  identifier:
    type: string
  coverage:
    type: string
  licence:
    description: définition de la licence
    oneOf:
      - description: licence générique avec URI
        type: object
        properties:
          uri:
            type: string
          title:
            type: string
      - description: URL de la licence spécifique
        type: string
  doc_url:
    description: URL de la documentation
    type: string
  metadata:
    description: URL des métadonnées
    type: string
  yamlClass:
    type: string
    const: FeatureDataset
  wfsUrl:
    description: URL du service WFS exposant la couche
    type: string
  wfsOptions:
    description: options pour l'appel au service WFS exposant la couche
    type: object
    properties:
      referer:
        type: string
  featureModifier:
    description: code Php définissant et retournant une fonction Php anonyme modifiant un feature (utilisée dans WfsServerJsonAugmented)
    type: string
  ftModContext:
    description: propriété utilisée par featureModifier
    type: object
  dbpath:
    description: chemin commun des fichiers OGR à ajouter avant ogrPath
    type: string
  precision:
    description: nombre de décimales pour les coordonnées géographiques à conserver dans le chargement
    type: integer
  minZoom:
    description: zoom minimum d'affichage de la série
    type: integer
  maxZoom:
    description: zoom maximum d'affichage de la série
    type: integer
  layers:
    description: dictionnaire des couches indexé par leur nom
    $ref: '#/definitions/layerDictionary'
  layersByTheme:
    description: dictionnaire de thèmes regroupant des couches, chaque thème indexé par son nom
    type: object
    patternProperties: # la propriété est le nom du thème
      '^[-a-zA-Z0-9_àéèîôù]+$':
        description: dictionnaire de couches correspondant au thème
        $ref: '#/definitions/layerDictionary'
  shpfiles:
    description: Fichiers shp non recopiés comme layer sous la forme d'une liste ou d'un texte
    oneOf:
      - description: cas de la liste
        type: array
        items: {type: string}
      - description: cas du texte
        type: string
    
  mysql_database:
    description: Nom de la base MySQL en fonction du serveur MySQL
    type: object
    patternProperties: # la propriété est le nom du serveur MySQL
      '^[-a-zA-Z0-9.]+$':
        description: nom de la base MySQL
        type: string
